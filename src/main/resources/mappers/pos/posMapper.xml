<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hub.root.pos.mybatis.PosMapper">
	<resultMap type="com.hub.root.pos.posDTO.PosDTO" id="posDTO">
		<id property="store_id" column="store_id" />
		<result property="store_name" column="store_name" />
	</resultMap>
	<resultMap type="com.hub.root.pos.posDTO.BookingDTO" id="bookingDTO">
		<id property="booking_id" column="BOOKING_ID" />
		<result property="store_id" column="STORE_ID" />
		<result property="member_id" column="MEMBER_ID" />
		<result property="booking_date_booking" column="BOOKING_DATE_BOOKING" />
		<result property="booking_time" column="BOOKING_TIME" />
		<result property="booking_person" column="BOOKING_PERSON" />
		<result property="booking_phone" column="BOOKING_PHONE" />
		<result property="booking_status" column="BOOKING_STATUS" />
	</resultMap>
	<resultMap type="com.hub.root.pos.posDTO.keyDTO" id="keyDTO">
		<result property="store_id" column="store_id" />
		<result property="store_key" column="store_key" />
		<result property="key_status" column="key_status" />
	</resultMap>
	<resultMap type="com.hub.root.pos.posDTO.waitDTO" id="waitDTO">
		<result property="wait_num" column="wait_num" />
		<result property="store_id" column="store_id" />
		<result property="person_num" column="person_num" />
		<result property="wait_date" column="wait_date" />
		<result property="wait_status" column="wait_status" />
		<result property="wait_time" column="wait_time" />
		<result property="wait_name" column="wait_name" />
	</resultMap>
	
	<select id="login_chk" resultMap="posDTO">
		select store_id, store_name from store_info where store_id=#{id} and store_pwd =#{pwd} 
	</select>
	
	<select id="todayReservation" resultMap="bookingDTO">
		select * from booking_info where store_id = #{store_id} and booking_date_booking = TO_CHAR(SYSDATE, 'YYYY/MM/DD') and (booking_status = 0 or booking_status = 3) ORDER BY booking_time
	</select>
	
	<select id="todayWait" resultMap="waitDTO">
		select * from store_wait where store_id = #{store_id} and wait_date = TO_CHAR(SYSDATE, 'YYYY/MM/DD') order by wait_num 
	</select>
	
	<insert id="register_booking">
		 insert into BOOKING_INFO(booking_id, store_id, member_id, booking_date_booking, booking_time, booking_person, booking_phone, booking_status) values(BOOKING_INFO_SEQ.nextval, #{store_id}, #{member_id}, #{booking_date_booking}, #{booking_time}, #{booking_person}, #{booking_phone}, #{booking_status})
	</insert>

	<select id="check_booking_maxNum" resultType="int">
		select A.booking_id from(select * from booking_info order by booking_id DESC)A where rownum = 1
	</select>
	
	<update id="bookingStatus">
		update booking_info set booking_status = #{booking_status} where booking_id = #{booking_id}
	</update>
	
	<select id="totalRegisterCount" resultType="int">
		select count(*) from booking_info where (BOOKING_STATUS = 1 or BOOKING_STATUS = 2) and store_id = #{store_id} and member_id = #{member_id}
	</select>
	
	<insert id="key">
		insert into store_key(STORE_ID, STORE_KEY, key_status) values(#{store_id}, #{store_key}, #{key_status})		
	</insert>
	
	<select id="getAllKey" resultMap="keyDTO">
		select * from store_key where store_id = #{userId}
	</select>
	
	<select id="wait_keyCheck" resultMap="keyDTO">
		select * from store_key where store_key = #{key}
	</select>
	
	<update id="update_keyStatus">
		update store_key set key_status= 1 where store_key = #{store_key} 
	</update>
	
	<delete id="delete_key">
		delete from store_key where store_key = #{store_key}
	</delete>
	
	<select id="findStoreId" resultType="String">
		select store_id from store_key where store_key = #{key}
	</select>
	
	<insert id="registerWait">
		insert into store_wait values(#{wait_num}, #{store_id}, #{person_num}, TO_CHAR(SYSDATE, 'YYYY/MM/DD'), 0, 0, #{name})
	</insert>
	
	<select id="wait_num" resultType="int">
		select count(*) from store_wait where wait_date = TO_CHAR(SYSDATE, 'YYYY/MM/DD')
	</select>
</mapper>