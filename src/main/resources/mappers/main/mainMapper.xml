<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hub.root.main.mybatis.mainMapper">
<resultMap type="com.hub.root.main.dto.MainDTO" id="main">
	<id property="store_id" column="store_id"/>
	<result property="store_menu_img" column="store_menu_img"/>
	<result property="store_menu_name" column="store_menu_name"/>
	<result property="store_menu_detail" column="store_menu_detail"/>
	<result property="store_menu_category" column="store_menu_category"/>
	<result property="store_menu_price" column="store_menu_price"/>
</resultMap>
<insert id="infoSave">
	insert into store_menu(store_id, store_menu_img, store_menu_name, store_menu_price,
		store_menu_detail, store_menu_category) values(#{store_id},#{store_menu_img},
		#{store_menu_name},#{store_menu_price},#{store_menu_detail},#{store_menu_category})
</insert>
<select id="mainPage1" resultMap="main">
	select * from store_menu
</select>
<!-- 아이디 검색시 성공
<select id="search" resultMap="main">
	select * from store_menu where store_menu_name in
	<foreach item="id" collection="list" open="(" separator="," close=")">
		#{id}
	</foreach>
</select>
 -->
 <!-- 메뉴이름만 검색할때의 쿼리 성공 
<select id="search" resultMap="main">
    SELECT * FROM store_menu
    <where>
        <if test="store_menu_name != null and store_menu_name.size() > 0">
            AND store_menu_name IN
            <foreach item="name" collection="store_menu_name" open="(" separator="," close=")">
                #{name}
            </foreach>
        </if>
    </where>
</select>
-->
<!-- 메뉴이름 또는 종류검색시 검색 성공 쿼리
<select id="search" resultMap="main">
    SELECT * FROM store_menu
    <where>
        <if test="keyword != null and keyword != ''">
            (store_menu_name LIKE '%' || #{keyword} || '%'
            OR store_menu_category LIKE '%' || #{keyword} || '%')
        </if>
    </where>
</select>
 -->
 <!-- 전체, 메뉴이름 또는 종류검색시 검색 (드롭다운을 통한) 성공 쿼리  -->
<select id="search" resultMap="main">
        SELECT * FROM store_menu
        <where>
            <if test="params.keyword != null and params.keyword != ''">
                <choose>
                    <when test="params.searchType == 'menu_name'">
                        store_menu_name LIKE '%' || #{params.keyword} || '%'
                    </when>
                    <when test="params.searchType == 'menu_category'">
                        store_menu_category LIKE '%' || #{params.keyword} || '%'
                    </when>
                    <otherwise>
                        store_menu_name LIKE '%' || #{params.keyword} || '%'
                        OR store_menu_category LIKE '%' || #{params.keyword} || '%'
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>
</mapper>











